{% extends 'store/base.html' %}
{% load static %}

{% block title %}Checkout - PyKart{% endblock %}

{% block content %}
<div class="container">
    <div class="breadcrumb">
        <a href="{% url 'store:home' %}">Home</a> / 
        <a href="{% url 'cart:view_cart' %}">Cart</a> / 
        <span>Checkout</span>
    </div>

    <h1 class="page-title">Checkout</h1>

    {% if addresses %}
    <form method="post" class="checkout-form" id="checkout-form">
        {% csrf_token %}
        <div class="checkout-container">
            <div class="checkout-main">
                <div class="checkout-section">
                    <h2>Shipping Address</h2>
                    <div class="address-selection">
                        {% for address in addresses %}
                        <div class="address-option">
                            <input type="radio" name="address_id" value="{{ address.id }}" 
                                   id="address_{{ address.id }}" 
                                   {% if address.is_default %}checked{% endif %}
                                   required>
                            <label for="address_{{ address.id }}" class="address-label">
                                <div class="address-card-small">
                                    <strong>{{ address.full_name }}</strong>
                                    <p>{{ address.get_full_address }}</p>
                                    <p>Phone: {{ address.phone_number }}</p>
                                    {% if address.is_default %}
                                    <span class="default-badge-small">Default</span>
                                    {% endif %}
                                </div>
                            </label>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <div class="checkout-actions">
                        <a href="{% url 'accounts:address_create' %}" class="btn-add-address">Add New Address</a>
                    </div>
                </div>

            <div class="checkout-section">
                <h2>Order Summary</h2>
                <div class="order-items">
                    {% for item in cart_items %}
                    <div class="order-item-summary">
                        <div class="item-info">
                            {% if item.product.main_image %}
                                <img src="{{ item.product.main_image.url }}" alt="{{ item.product.name }}" class="item-image-small">
                            {% endif %}
                            <div>
                                <h4>{{ item.product.name }}</h4>
                                <p>Quantity: {{ item.quantity }}</p>
                            </div>
                        </div>
                        <div class="item-price">₹{{ item.get_subtotal }}</div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="checkout-sidebar">
            <div class="order-summary-card">
                <h2>Order Total</h2>
                <div class="summary-row">
                    <span>Subtotal:</span>
                    <span>₹{{ subtotal|floatformat:2 }}</span>
                </div>
                <div class="summary-row">
                    <span>Tax (10%):</span>
                    <span>₹{{ tax|floatformat:2 }}</span>
                </div>
                <div class="summary-row">
                    <span>Shipping:</span>
                    <span>
                        {% if shipping_cost == 0 %}
                            <span class="free-shipping">FREE</span>
                        {% else %}
                            ₹{{ shipping_cost|floatformat:2 }}
                        {% endif %}
                    </span>
                </div>
                <div class="summary-row total">
                    <span>Total:</span>
                    <span>₹{{ total|floatformat:2 }}</span>
                </div>
                
                <div class="payment-section">
                    <h3>Payment Method</h3>
                    <p class="payment-info">Mock Payment - No actual payment will be processed</p>
                </div>
                
                <button type="submit" form="checkout-form" class="btn-place-order">Place Order</button>
                <a href="{% url 'cart:view_cart' %}" class="btn-back-cart">Back to Cart</a>
            </div>
        </div>
    </form>
    {% else %}
    <div class="checkout-container">
        <div class="no-addresses">
            <p>You need to add a shipping address before checkout.</p>
            <a href="{% url 'accounts:address_create' %}" class="btn-primary">Add Address</a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

